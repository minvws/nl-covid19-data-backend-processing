-- Hiervoor eenmalig een query runnen die dit INTO een VWSARCHIVE tabel schrijft
 -- met als extensie 20220908 en die filtert op de datum 2022-0908
 
 
 -- 1) CREATE STORED PROCEDURE(S): ARCHIVE EXISTING DATA
 CREATE   PROCEDURE [DBO].[SP_BEHAVIOR_PER_REGION_DEST_TO_ARCHIVED_20220908]
 AS
 BEGIN
 TRUNCATE TABLE [VWSARCHIVE].[BEHAVIOR_PER_REGION_ARCHIVED_20221019]
 
     INSERT INTO [VWSARCHIVE].[BEHAVIOR_PER_REGION_ARCHIVED_20221019] (        
         [DATE_LAST_INSERTED] ,
         [DATE_OF_REPORT],
         [VRCODE],
         [NUMBER_OF_PARTICIPANTS] ,
         [WASH_HANDS_COMPLIANCE] ,
         [WASH_HANDS_COMPLIANCE_TREND] ,
         [KEEP_DISTANCE_COMPLIANCE],
         [KEEP_DISTANCE_COMPLIANCE_TREND],
         [WORK_FROM_HOME_COMPLIANCE],
         [WORK_FROM_HOME_COMPLIANCE_TREND],
         [AVOID_CROWDS_COMPLIANCE],
         [AVOID_CROWDS_COMPLIANCE_TREND],
         [SYMPTOMS_STAY_HOME_COMPLIANCE],
         [SYMPTOMS_STAY_HOME_COMPLIANCE_TREND],
         [SYMPTOMS_GET_TESTED_COMPLIANCE],
         [SYMPTOMS_GET_TESTED_COMPLIANCE_TREND],
         [WEAR_MASK_PUBLIC_INDOORS_COMPLIANCE],
         [WEAR_MASK_PUBLIC_INDOORS_COMPLIANCE_TREND],
         [WEAR_MASK_PUBLIC_TRANSPORT_COMPLIANCE],
         [WEAR_MASK_PUBLIC_TRANSPORT_COMPLIANCE_TREND]  ,
         [SNEEZE_COUGH_ELBOW_COMPLIANCE]  ,
         [SNEEZE_COUGH_ELBOW_COMPLIANCE_TREND]  ,
         [MAX_VISITORS_COMPLIANCE]  ,
         [MAX_VISITORS_COMPLIANCE_TREND]  ,
         [WASH_HANDS_SUPPORT]  ,
         [WASH_HANDS_SUPPORT_TREND]  ,
         [KEEP_DISTANCE_SUPPORT]  ,
         [KEEP_DISTANCE_SUPPORT_TREND]  ,
         [WORK_FROM_HOME_SUPPORT]  ,
         [WORK_FROM_HOME_SUPPORT_TREND]  ,
         [AVOID_CROWDS_SUPPORT]  ,
         [AVOID_CROWDS_SUPPORT_TREND]  ,
         [SYMPTOMS_STAY_HOME_SUPPORT]  ,
         [SYMPTOMS_STAY_HOME_SUPPORT_TREND]  ,
         [SYMPTOMS_GET_TESTED_SUPPORT]  ,
         [SYMPTOMS_GET_TESTED_SUPPORT_TREND]  ,
         [WEAR_MASK_PUBLIC_INDOORS_SUPPORT]  ,
         [WEAR_MASK_PUBLIC_INDOORS_SUPPORT_TREND]  ,
         [WEAR_MASK_PUBLIC_TRANSPORT_SUPPORT]  ,
         [WEAR_MASK_PUBLIC_TRANSPORT_SUPPORT_TREND]  ,
         [SNEEZE_COUGH_ELBOW_SUPPORT]  ,
         [SNEEZE_COUGH_ELBOW_SUPPORT_TREND]  ,
         [MAX_VISITORS_SUPPORT]  ,
         [MAX_VISITORS_SUPPORT_TREND]  ,
         [CURFEW_COMPLIANCE]  ,
         [CURFEW_COMPLIANCE_TREND]  ,
         [CURFEW_SUPPORT]  ,
         [CURFEW_SUPPORT_TREND]  ,
         [VENTILATE_HOME_COMPLIANCE]  ,
         [VENTILATE_HOME_COMPLIANCE_TREND]  ,
         [VENTILATE_HOME_SUPPORT]  ,
         [VENTILATE_HOME_SUPPORT_TREND]  ,
         [SELFTEST_VISIT_COMPLIANCE]  ,
         [SELFTEST_VISIT_COMPLIANCE_TREND]  ,
         [SELFTEST_VISIT_SUPPORT]  ,
         [SELFTEST_VISIT_SUPPORT_TREND]  
     )
     SELECT 
         [DATE_LAST_INSERTED] ,
         [DATE_OF_REPORT],
         [VRCODE],
         [NUMBER_OF_PARTICIPANTS] ,
         [WASH_HANDS_COMPLIANCE] ,
         [WASH_HANDS_COMPLIANCE_TREND] ,
         [KEEP_DISTANCE_COMPLIANCE],
         [KEEP_DISTANCE_COMPLIANCE_TREND],
         [WORK_FROM_HOME_COMPLIANCE],
         [WORK_FROM_HOME_COMPLIANCE_TREND],
         [AVOID_CROWDS_COMPLIANCE],
         [AVOID_CROWDS_COMPLIANCE_TREND],
         [SYMPTOMS_STAY_HOME_COMPLIANCE],
         [SYMPTOMS_STAY_HOME_COMPLIANCE_TREND],
         [SYMPTOMS_GET_TESTED_COMPLIANCE],
         [SYMPTOMS_GET_TESTED_COMPLIANCE_TREND],
         [WEAR_MASK_PUBLIC_INDOORS_COMPLIANCE],
         [WEAR_MASK_PUBLIC_INDOORS_COMPLIANCE_TREND],
         [WEAR_MASK_PUBLIC_TRANSPORT_COMPLIANCE],
         [WEAR_MASK_PUBLIC_TRANSPORT_COMPLIANCE_TREND]  ,
         [SNEEZE_COUGH_ELBOW_COMPLIANCE]  ,
         [SNEEZE_COUGH_ELBOW_COMPLIANCE_TREND]  ,
         [MAX_VISITORS_COMPLIANCE]  ,
         [MAX_VISITORS_COMPLIANCE_TREND]  ,
         [WASH_HANDS_SUPPORT]  ,
         [WASH_HANDS_SUPPORT_TREND]  ,
         [KEEP_DISTANCE_SUPPORT]  ,
         [KEEP_DISTANCE_SUPPORT_TREND]  ,
         [WORK_FROM_HOME_SUPPORT]  ,
         [WORK_FROM_HOME_SUPPORT_TREND]  ,
         [AVOID_CROWDS_SUPPORT]  ,
         [AVOID_CROWDS_SUPPORT_TREND]  ,
         [SYMPTOMS_STAY_HOME_SUPPORT]  ,
         [SYMPTOMS_STAY_HOME_SUPPORT_TREND]  ,
         [SYMPTOMS_GET_TESTED_SUPPORT]  ,
         [SYMPTOMS_GET_TESTED_SUPPORT_TREND]  ,
         [WEAR_MASK_PUBLIC_INDOORS_SUPPORT]  ,
         [WEAR_MASK_PUBLIC_INDOORS_SUPPORT_TREND]  ,
         [WEAR_MASK_PUBLIC_TRANSPORT_SUPPORT]  ,
         [WEAR_MASK_PUBLIC_TRANSPORT_SUPPORT_TREND]  ,
         [SNEEZE_COUGH_ELBOW_SUPPORT]  ,
         [SNEEZE_COUGH_ELBOW_SUPPORT_TREND]  ,
         [MAX_VISITORS_SUPPORT]  ,
         [MAX_VISITORS_SUPPORT_TREND]  ,
         [CURFEW_COMPLIANCE]  ,
         [CURFEW_COMPLIANCE_TREND]  ,
         [CURFEW_SUPPORT]  ,
         [CURFEW_SUPPORT_TREND]  ,
         [VENTILATE_HOME_COMPLIANCE]  ,
         [VENTILATE_HOME_COMPLIANCE_TREND]  ,
         [VENTILATE_HOME_SUPPORT]  ,
         [VENTILATE_HOME_SUPPORT_TREND]  ,
         [SELFTEST_VISIT_COMPLIANCE]  ,
         [SELFTEST_VISIT_COMPLIANCE_TREND]  ,
         [SELFTEST_VISIT_SUPPORT]  ,
         [SELFTEST_VISIT_SUPPORT_TREND]  
     FROM [VWSDEST].[BEHAVIOR_PER_REGION] WITH(NOLOCK)
     WHERE [DATE_LAST_INSERTED] = (SELECT MAX([DATE_LAST_INSERTED]) FROM [VWSDEST].[BEHAVIOR_PER_REGION]);
 
 
     UPDATE  c 
     SET c.Active = 0
     FROM [DATATINO_PROTO_1].[CONFIGURATIONS] c
     INNER JOIN [DATATINO_PROTO_1].[VIEWS] v on v.Id = c.View_Id
     WHERE v.Name = 'VWSDEST.V_BEHAVIOR_PER_REGION'
     OR v.Name = 'VWSDEST.V_BEHAVIOR_REGIONS'
 END;